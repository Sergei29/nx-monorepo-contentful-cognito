# NxReactMonorepo

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

âœ¨ **This workspace has been generated by [Nx, Smart Monorepos Â· Fast CI.](https://nx.dev)** âœ¨

### Setup Testing with Vite

1. remove all jest related packages
2. $ `nx add @nx/vite`
3. $ `npx nx g @nx/vite:vitest --project=nx-react-monorepo --testEnvironment=jsdom --uiFramework=react`
4. Install testing dependencies for React, Vite and Canvas

- $ `yarn add -D @testing-library/react @testing-library/jest-dom @vitejs/plugin-react vite-tsconfig-paths vitest-canvas-mock`

That's a lot of dependencies ðŸ˜„ , so let's break them down:

- `"@testing-library/react"`: A library for testing React components. It provides utilities to simulate user interactions and query elements in a way that's more aligned with how users interact with your app.

- `"@testing-library/jest-dom"`: A set of custom matchers that makes it easier to assert how your components should behave in the DOM.

- `"@vitejs/plugin-react"`: The official Vite plugin to support React. This plugin enables features like Fast Refresh in a Vite + React development setup.

- `"vite-tsconfig-paths"`: A Vite plugin that enables support for TypeScript's paths and baseUrl configuration options. This is useful when you want to set up custom path aliases in a TypeScript project using Vite.

- `"vitest-canvas-mock"`: Mocks the canvas API when running unit tests with vitest.

5. Add a test setup file

```ts
import { afterEach, expect } from 'vitest';
import { cleanup } from '@testing-library/react';
import * as matchers from '@testing-library/jest-dom/matchers';
// Option for using mocking canvas testing
import 'vitest-canvas-mock';

expect.extend(matchers);

// runs a cleanup after each test case (e.g. clearing jsdom)
afterEach(() => {
  cleanup();
});

// Add Default Functions, for example providers as here:
// https://testing-library.com/docs/react-testing-library/setup/#custom-render

/* eslint-disable @typescript-eslint/no-empty-function */
const noop = () => {};
Object.defineProperty(window, 'scrollTo', { value: noop, writable: true });
```

6. Update Vite Config to support test setup and reference libraries in MonoRepo

```ts
/// <reference types='vitest' />
/// <reference types="vite/client" />

import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';

export default defineConfig({
  root: __dirname,
  cacheDir: '../../node_modules/.vite/apps/nx-react-monorepo',

  plugins: [react(), nxViteTsPaths()],

  // Uncomment this if you are using workers.
  // worker: {
  //  plugins: [ nxViteTsPaths() ],
  // },

  test: {
    root: __dirname,
    globals: true,
    cache: {
      dir: '../../node_modules/.vitest',
    },
    environment: 'jsdom',
    include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}', '__tests__/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    deps: {
      // Required for vitest-canvas-mock
      inline: ['vitest-canvas-mock'],
    },
    setupFiles: ['./test-setup.ts'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../../coverage/apps/nx-react-monorepo',
      provider: 'v8',
    },
  },
});
```

7. make sure the project.json config reflects the test command:

```json
{
  "name": "nx-react-monorepo",
  // ...
  "targets": {
    "test": {
      "executor": "@nx/vite:test",
      "options": {
        "config": "apps/nx-react-monorepo/vite.config.ts"
      },
      "configurations": {
        "watch": {
          "watch": true
        }
      }
    }
  }
}
```

8. then you can write unit tests in `nx-react-monorepo/__tests/` directory
9. $ `nx test nx-react-monorepo`

## Integrate with editors

Enhance your Nx experience by installing [Nx Console](https://nx.dev/nx-console) for your favorite editor. Nx Console
provides an interactive UI to view your projects, run tasks, generate code, and more! Available for VSCode, IntelliJ and
comes with a LSP for Vim users.

## Start the application

Run `npx nx dev nx-react-monorepo` to start the development server. Happy coding!

## Build for production

Run `npx nx build nx-react-monorepo` to build the application. The build artifacts are stored in the output directory (e.g. `dist/` or `build/`), ready to be deployed.

## Running tasks

To execute tasks with Nx use the following syntax:

```
npx nx <target> <project> <...options>
```

You can also run multiple targets:

```
npx nx run-many -t <target1> <target2>
```

..or add `-p` to filter specific projects

```
npx nx run-many -t <target1> <target2> -p <proj1> <proj2>
```

Targets can be defined in the `package.json` or `projects.json`. Learn more [in the docs](https://nx.dev/features/run-tasks).

## Set up CI!

Nx comes with local caching already built-in (check your `nx.json`). On CI you might want to go a step further.

- [Set up remote caching](https://nx.dev/features/share-your-cache)
- [Set up task distribution across multiple machines](https://nx.dev/nx-cloud/features/distribute-task-execution)
- [Learn more how to setup CI](https://nx.dev/recipes/ci)

## Explore the project graph

Run `npx nx graph` to show the graph of the workspace.
It will show tasks that you can run with Nx.

- [Learn more about Exploring the Project Graph](https://nx.dev/core-features/explore-graph)

## Connect with us!

- [Join the community](https://nx.dev/community)
- [Subscribe to the Nx Youtube Channel](https://www.youtube.com/@nxdevtools)
- [Follow us on Twitter](https://twitter.com/nxdevtools)
